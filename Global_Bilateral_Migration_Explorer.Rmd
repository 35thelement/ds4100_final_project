---
title: "Global Bilateral Migration Explorer"
output:
  flexdashboard::flex_dashboard:
    social: menu
    source: embed
    fig_mobile: FALSE # Set TRUE to prerender figures for mobile devices
    theme: united
    vertical_layout: scroll
runtime: shiny_prerendered
---

```{r, include=FALSE}
# Pages to-do:
# - front page with report as outlined in project requirements (we have prof's ok to do it like this)
# - interactive network
#   - color nodes based on region or income group (default region)
#   - display all migration and population data for a country on mouse-over or click
#   - display data for either one year or all years cumulatively, population only for single years (default all)
#   - select population, immigration, or emmigration for node sizing (default population if single year, none otherwise)
#   - group countries by region and/or income group (default none)
#   - display all countries at 1, 2, or 3 degrees of separation to a selected country (default none, i.e. all countries)
# - line/bar charts
#   - time series of all data for a selected country
#   - time series of immigration and emmigration between two selected countries (possibly on separate page)
# - analysis of migration network (do these for each year, and all years cumulatively)
#   - find clustering coefficient of migration network
#   - use connected components algorithm to determine if graph is connected
#   - use Louvain algorithm for (hierarchical?) community detection (use Cypher projection)
# - boxplots, t-tests, regressions
# - [optional] cypher query input (sanitize!) with query output downloader (using temp files)
```


```{r setup, include=FALSE}
# Load required packages and install them if necessary
if (!"flexdashboard" %in% rownames(installed.packages())) {
  install.packages("flexdashboard")
}
library(flexdashboard)

if (!"shiny" %in% rownames(installed.packages())) {
  install.packages("shiny")
}
library(shiny)

if (!"visNetwork" %in% rownames(installed.packages())) {
  install.packages("visNetwork")
}
library(visNetwork)

if (!"ggplot2" %in% rownames(installed.packages())) {
  install.packages("ggplot2")
}
library(ggplot2)

if (!"tidyverse" %in% rownames(installed.packages())) {
  install.packages("tidyverse")
}
library(tidyverse)

if (!"neo4r" %in% rownames(installed.packages())) {
  install.packages("neo4r")
}
library(neo4r)

source("populate_neo4j.R")
```

Introduction {data-orientation=rows}
===================================================================================

```{r, context="server"}
output$model <- renderImage({
  list(src="./GBMDB_model.png", height="100%", width="100%")
}, deleteFile = F)
```

Row 
-----------------------------------------------------------------------------------
### Motivation
Some Text

### Data
Some Text

Facts are represented as nodes to optimise query performance. Neo4j uses pointer chasing to match patterns of nodes and edges, which is much faster than searching on data contained in node and edge properties. The chart below shows an example of the data model.

Row {data-height=1000, data-width=750}
-----------------------------------------------------------------------------------
### Data Model for Neo4j
```{r}
imageOutput("model")
```

Row 
-----------------------------------------------------------------------------------
### Challenges
Some Text

### Insights
Some Text

Network
===================================================================================
```{r}
con$ping()
```

Time Series
===================================================================================
```{r}
query <- call_neo4j('match (c:Country)-[:EMMIGRATION]->(m:Migration) return c.name as Name_Of_Country, sum(m.total) as Total_Emigrations, sum(m.male) as Male_Emigrations, sum(m.female) as Female_Emigrations', con)

data.frame(query)
```



Analysis
===================================================================================


